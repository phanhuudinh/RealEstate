(function(n){typeof define=="function"&&define.amd?define(["jquery","datatables.net"],function(t){return n(t,window,document)}):typeof exports=="object"?module.exports=function(t,i){return t||(t=window),i&&i.fn.dataTable||(i=require("datatables.net")(t,i).$),n(i,t,t.document)}:n(jQuery,window,document)})(function(n,t,i){"use strict";function f(t,i){var o=t.row(i),r=n(o.node()).attr("parent-index"),u;if(r!=null){r=+r;var e='[parent-index="'+r+'"]',s=t.rows(e).nodes(),h=t.rows(e,{selected:!0}).nodes();s.length===h.length&&(u=t.row(r,{selected:!1}),u.select(),u.node()&&f(t,r))}}function e(n,t){var i=n.rows('[parent-index="'+t+'"]',{selected:!1}),r=i.indexes().toArray();r.length&&(i.select(),r.forEach(function(t){e(n,t)}))}function o(t,i){var f=t.row(i),r=n(f.node()).attr("parent-index"),u;r!=null&&(r=+r,u=t.row(r,{selected:!0}),u.deselect(),u.node()&&o(t,r))}function s(n,t){var i=n.rows('[parent-index="'+t+'"]',{selected:!0}),r=i.indexes().toArray();r.length&&(i.deselect(),r.forEach(function(t){s(n,t)}))}var u=n.fn.dataTable,r=function(t,i){var f=this,u;if(!(this instanceof r)){alert('TreeGrid warning: TreeGrid must be initialised with the "new" keyword.');return}if((i===undefined||i===!0)&&(i={}),u=new n.fn.dataTable.Api(t).settings()[0],this.s={dt:u},u._oTreeGrid)throw"TreeGrid already initialised on this table";u._oTreeGrid=this;u._bInitComplete?this.fnConstruct(i):u.oApi._fnCallbackReg(u,"aoInitComplete",function(){f.fnConstruct(i)},"TreeGrid")};n.extend(r.prototype,{fnConstruct:function(t){var h;this.s=n.extend(!0,this.s,r.defaults,t);var v=this.s.dt,u=v._select,i=n(v.nTable).dataTable().api(),c=this.s.left,l={},y=n(this.s.expandIcon),w=n(this.s.collapseIcon),a=function(t){var r=[],u;if(t)r.push(t);else for(u in l)l.hasOwnProperty(u)&&r.push(u);r.forEach(function(t){var r=l[t];r&&r.length&&(r.forEach(function(t){i.row(n(t)).remove();n(t).remove()}),delete l[t],n(i.row(t).node()).find(".treegrid-control-open").each(function(t,i){n(i).removeClass("treegrid-control-open").addClass("treegrid-control");n(i).html("").append(y.clone())}))})},p=function(t){var i=["odd","even"];n(t.table().body()).find("tr").each(function(t,r){n(r).removeClass("odd even").addClass(i[t%2])})};i.on("click","td.treegrid-control",function(){var r,v,o;if(n(this).html()){r=[];u&&(r=i.rows({selected:!0}).indexes().toArray());var f=i.row(this),s=f.index(),e=f.data(),t=n(i.cell(this).node()),y=parseInt(t.css("padding-left"),10),h=parseInt(t.find("span").css("margin-left")||0,10)/c,a=w.clone();a.css("marginLeft",h*c+"px");t.removeClass("treegrid-control").addClass("treegrid-control-open");t.html("").append(a);e.children&&e.children.length&&(v=l[s]=[],o=f.node(),e.children.forEach(function(t){var e=i.row.add(t),r=e.node(),u=n(r).find(".treegrid-control"),f=(h+1)*c;n(r).attr("parent-index",s);u.find("span").css("marginLeft",f+"px");u.next().css("paddingLeft",y+f+"px");n(r).insertAfter(o);o=r;v.push(r)}),p(i),u&&setTimeout(function(){i.rows(r).select()},0))}});i.on("click","td.treegrid-control-open",function(){var r=[],e;u&&(r=i.rows({selected:!0}).indexes().toArray());var t=n(i.cell(this).node()),o=parseInt(t.find("span").css("margin-left")||0,10)/c,f=y.clone();f.css("marginLeft",o*c+"px");t.removeClass("treegrid-control-open").addClass("treegrid-control");t.html("").append(f);e=i.row(this).index();a(e);p(i);u&&setTimeout(function(){i.rows(r).select()},0)});i.on("page",function(){a()});i.on("order",function(){a()});h=!1;u&&u.style==="multi"&&i.on("select",function(n,t,r,u){h||(h=!0,u.forEach(function(n){f(i,n);e(i,n)}),h=!1)});u&&u.style==="multi"&&i.on("deselect",function(n,t,r,u){h||(h=!0,u.forEach(function(n){o(i,n);s(i,n)}),h=!1)})}});r.defaults={left:12,expandIcon:"<span>+<\/span>",collapseIcon:"<span>-<\/span>"};r.version="1.0.0";u.Api.register("treeGrid()",function(){return this});n(i).on("init.dt.treeGrid",function(t,i){var f,e,o;t.namespace==="dt"&&(f=i.oInit.treeGrid,e=u.defaults.treeGrid,(f||e)&&(o=n.extend({},f,e),f!==!1&&new r(i,o)))});return n.fn.dataTable.TreeGrid=r,n.fn.DataTable.TreeGrid=r,r});